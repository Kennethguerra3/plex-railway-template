#!/usr/bin/with-contenv bash

echo "Applying permissions for /data volume..."
# Asegurar que el usuario plex sea due√±o de la carpeta de datos
chown -R plex:plex /data
chmod -R 775 /data

# Inicializar Base de Datos de FileBrowser con admin/admin
DB_PATH="/config/filebrowser.db"
if [ ! -f "$DB_PATH" ]; then
    echo "Initializing File Browser database with default credentials (admin/admin)..."
    /usr/local/bin/filebrowser config init --database "$DB_PATH"
    /usr/local/bin/filebrowser config set --database "$DB_PATH" --address 0.0.0.0 --port 9090 --root /data
    # Agregar usuario admin con password admin
    /usr/local/bin/filebrowser users add admin admin --database "$DB_PATH"
    # Asegurar que el usuario plex pueda escribir en la base de datos
    chown plex:plex "$DB_PATH"
    echo "File Browser initialization complete."
fi

echo "Permissions and Initialization applied successfully."
